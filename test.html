<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievement System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>Achievement System Test</h1>
    
    <div class="test-section">
        <h2>Test Controls</h2>
        <button class="test-btn" onclick="testAddTask()">Add Test Task</button>
        <button class="test-btn" onclick="testCompleteTask()">Complete Last Task</button>
        <button class="test-btn" onclick="testGetStats()">Get Stats</button>
        <button class="test-btn" onclick="testGetDebugInfo()">Get Debug Info</button>
        <button class="test-btn" onclick="testCheckAllBadges()">Check All Badges</button>
        <button class="test-btn" onclick="testReset()">Reset All</button>
    </div>
    
    <div class="test-section">
        <h2>Quick Tests</h2>
        <button class="test-btn" onclick="testFirstTaskBadge()">Test First Task Badge</button>
        <button class="test-btn" onclick="testTaskMasterBadge()">Test Task Master Badge</button>
        <button class="test-btn" onclick="testStreakBadges()">Test Streak Badges</button>
        <button class="test-btn" onclick="testLevelBadges()">Test Level Badges</button>
        <button class="test-btn" onclick="testTimeBasedBadges()">Test Time-Based Badges</button>
    </div>
    
    <div class="test-section">
        <h2>Output</h2>
        <div id="output" class="output">Ready to test...</div>
    </div>
    
    <script type="module">
        import { Gamification } from './js/gamify.js';
        
        let gamification;
        let testTasks = [];
        
        // Initialize gamification system
        async function initTest() {
            try {
                gamification = new Gamification();
                await gamification.init();
                log('Gamification system initialized successfully', 'success');
                log('Debug methods available at window.gamificationDebug');
            } catch (error) {
                log('Failed to initialize gamification: ' + error.message, 'error');
            }
        }
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            output.innerHTML += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        // Test functions
        window.testAddTask = function() {
            const task = {
                id: Date.now().toString(),
                text: `Test task ${testTasks.length + 1}`,
                completed: false,
                createdAt: new Date().toISOString(),
                tags: ['test'],
                priority: 'normal'
            };
            
            testTasks.push(task);
            gamification.addTask(task);
            log(`Added test task: ${task.text}`, 'success');
        };
        
        window.testCompleteTask = function() {
            if (testTasks.length === 0) {
                log('No tasks to complete', 'error');
                return;
            }
            
            const task = testTasks[testTasks.length - 1];
            task.completed = true;
            task.completedAt = new Date().toISOString();
            gamification.completeTask(task);
            log(`Completed task: ${task.text}`, 'success');
        };
        
        window.testGetStats = function() {
            const stats = gamification.getStats();
            log('Current Stats:', 'info');
            log(JSON.stringify(stats, null, 2));
        };
        
        window.testGetDebugInfo = function() {
            const debugInfo = gamification.getDebugInfo();
            log('Debug Info:', 'info');
            log(JSON.stringify(debugInfo, null, 2));
        };
        
        window.testCheckAllBadges = function() {
            gamification.checkAllBadges();
            log('Checked all badges', 'info');
        };
        
        window.testReset = function() {
            gamification.reset();
            testTasks = [];
            log('Reset all data', 'warning');
        };
        
        // Quick test functions
        window.testFirstTaskBadge = function() {
            log('Testing First Task Badge...', 'info');
            gamification.reset();
            testTasks = [];
            
            // Add and complete one task
            window.testAddTask();
            window.testCompleteTask();
            
            const stats = gamification.getStats();
            if (stats.badges.includes('firstTask')) {
                log('First Task badge earned successfully!', 'success');
            } else {
                log('First Task badge not earned', 'error');
            }
        };
        
        window.testTaskMasterBadge = function() {
            log('Testing Task Master Badge...', 'info');
            gamification.reset();
            testTasks = [];
            
            // Add and complete 10 tasks
            for (let i = 0; i < 10; i++) {
                window.testAddTask();
                window.testCompleteTask();
            }
            
            const stats = gamification.getStats();
            if (stats.badges.includes('taskMaster')) {
                log('Task Master badge earned successfully!', 'success');
            } else {
                log('Task Master badge not earned', 'error');
            }
        };
        
        window.testStreakBadge = function() {
            log('Testing Streak Badges...', 'info');
            log('This test requires manual verification of streak logic', 'warning');
            
            const stats = gamification.getStats();
            log(`Current streak: ${stats.streak} days`, 'info');
            
            if (stats.streak >= 3 && !stats.badges.includes('streak3')) {
                log('Streak 3 badge should be earned', 'error');
            } else if (stats.streak >= 3) {
                log('Streak 3 badge earned correctly', 'success');
            }
        };
        
        window.testLevelBadges = function() {
            log('Testing Level Badges...', 'info');
            
            const stats = gamification.getStats();
            log(`Current level: ${stats.level}`, 'info');
            
            if (stats.level >= 5 && !stats.badges.includes('level5')) {
                log('Level 5 badge should be earned', 'error');
            } else if (stats.level >= 5) {
                log('Level 5 badge earned correctly', 'success');
            }
        };
        
        window.testTimeBasedBadges = function() {
            log('Testing Time-Based Badges...', 'info');
            
            const hour = new Date().getHours();
            const day = new Date().getDay();
            
            log(`Current time: ${hour}:00, Day: ${day} (0=Sunday, 6=Saturday)`, 'info');
            
            if (hour < 9) {
                log('Early Bird badge should be available', 'info');
            }
            if (hour >= 22) {
                log('Night Owl badge should be available', 'info');
            }
            if (day === 0 || day === 6) {
                log('Weekend Warrior badge should be available', 'info');
            }
        };
        
        // Initialize when page loads
        initTest();
    </script>
</body>
</html>
